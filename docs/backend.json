{
  "entities": {
    "User": {
      "$schema": "http://json-schema.org/draft-07/schema#",
      "title": "User",
      "type": "object",
      "description": "Represents a user of the EquityStream platform.",
      "properties": {
        "id": {
          "type": "string",
          "description": "Unique identifier for the user."
        },
        "email": {
          "type": "string",
          "description": "User's email address.",
          "format": "email"
        },
        "firstName": {
          "type": "string",
          "description": "User's first name."
        },
        "lastName": {
          "type": "string",
          "description": "User's last name."
        },
        "registrationDate": {
          "type": "string",
          "description": "Date and time when the user registered.",
          "format": "date-time"
        },
        "lastLogin": {
          "type": "string",
          "description": "Date and time of the user's last login.",
          "format": "date-time"
        },
        "apiKey": {
          "type": "string",
          "description": "API Key for the user to access EquityStream services."
        },
        "subscriptionTierId": {
          "type": "string",
          "description": "Reference to SubscriptionTier. (Relationship: SubscriptionTier 1:N User)"
        }
      },
      "required": [
        "id",
        "email",
        "firstName",
        "lastName",
        "registrationDate",
        "apiKey",
        "subscriptionTierId"
      ]
    },
    "SubscriptionTier": {
      "$schema": "http://json-schema.org/draft-07/schema#",
      "title": "SubscriptionTier",
      "type": "object",
      "description": "Represents the different subscription tiers available on EquityStream.",
      "properties": {
        "id": {
          "type": "string",
          "description": "Unique identifier for the subscription tier."
        },
        "name": {
          "type": "string",
          "description": "Name of the subscription tier (e.g., Free, Pro, Enterprise)."
        },
        "price": {
          "type": "number",
          "description": "Price of the subscription tier per month."
        },
        "dataLatency": {
          "type": "string",
          "description": "Description of the data latency provided by the subscription (e.g., Real-time, Delayed)."
        },
        "historicalDataDepth": {
          "type": "string",
          "description": "Description of the available historical data (e.g., 15+ years)."
        },
        "apiCallLimit": {
          "type": "number",
          "description": "Maximum number of API calls allowed per month."
        }
      },
      "required": [
        "id",
        "name",
        "price",
        "dataLatency",
        "historicalDataDepth",
        "apiCallLimit"
      ]
    },
    "ApiUsage": {
      "$schema": "http://json-schema.org/draft-07/schema#",
      "title": "ApiUsage",
      "type": "object",
      "description": "Tracks API usage for a user within a specific period.",
      "properties": {
        "id": {
          "type": "string",
          "description": "Unique identifier for the API usage record."
        },
        "userId": {
          "type": "string",
          "description": "Reference to User. (Relationship: User 1:N ApiUsage)"
        },
        "date": {
          "type": "string",
          "description": "Date of the API usage record.",
          "format": "date-time"
        },
        "apiCalls": {
          "type": "number",
          "description": "Number of API calls made by the user on that date."
        }
      },
      "required": [
        "id",
        "userId",
        "date",
        "apiCalls"
      ]
    },
    "MarketData": {
      "$schema": "http://json-schema.org/draft-07/schema#",
      "title": "MarketData",
      "type": "object",
      "description": "Represents a single data point for a specific stock at a given time.",
      "properties": {
        "id": {
          "type": "string",
          "description": "Unique identifier for the market data point."
        },
        "symbol": {
          "type": "string",
          "description": "Stock symbol (e.g., AAPL, GOOGL)."
        },
        "timestamp": {
          "type": "string",
          "description": "Timestamp of the data point.",
          "format": "date-time"
        },
        "open": {
          "type": "number",
          "description": "Opening price for the period."
        },
        "high": {
          "type": "number",
          "description": "Highest price for the period."
        },
        "low": {
          "type": "number",
          "description": "Lowest price for the period."
        },
        "close": {
          "type": "number",
          "description": "Closing price for the period."
        },
        "volume": {
          "type": "number",
          "description": "Trading volume for the period."
        }
      },
      "required": [
        "id",
        "symbol",
        "timestamp",
        "open",
        "high",
        "low",
        "close",
        "volume"
      ]
    },
    "ApiKey": {
      "$schema": "http://json-schema.org/draft-07/schema#",
      "title": "ApiKey",
      "type": "object",
      "description": "Stores API keys and their associated metadata.",
      "properties": {
        "id": {
          "type": "string",
          "description": "Unique identifier for the API key."
        },
        "userId": {
          "type": "string",
          "description": "Reference to User. (Relationship: User 1:1 ApiKey)"
        },
        "key": {
          "type": "string",
          "description": "The actual API key."
        },
        "createdAt": {
          "type": "string",
          "description": "Timestamp when the API key was created.",
          "format": "date-time"
        },
        "lastUsedAt": {
          "type": "string",
          "description": "Timestamp when the API key was last used.",
          "format": "date-time"
        },
        "isActive": {
          "type": "boolean",
          "description": "Indicates whether the API key is active."
        }
      },
      "required": [
        "id",
        "userId",
        "key",
        "createdAt",
        "isActive"
      ]
    }
  },
  "auth": {
    "providers": [
      "password",
      "anonymous"
    ]
  },
  "firestore": {
    "structure": [
      {
        "path": "/users/{userId}",
        "definition": {
          "entityName": "User",
          "schema": {
            "$ref": "#/backend/entities/User"
          },
          "description": "Stores user profiles. Uses path-based ownership for security. Only the user with the matching {userId} can read/write their own document.",
          "params": [
            {
              "name": "userId",
              "description": "The unique identifier for the user."
            }
          ]
        }
      },
      {
        "path": "/subscriptionTiers/{subscriptionTierId}",
        "definition": {
          "entityName": "SubscriptionTier",
          "schema": {
            "$ref": "#/backend/entities/SubscriptionTier"
          },
          "description": "Stores subscription tier details.  Globally readable.",
          "params": [
            {
              "name": "subscriptionTierId",
              "description": "The unique identifier for the subscription tier."
            }
          ]
        }
      },
      {
        "path": "/users/{userId}/apiUsage/{apiUsageId}",
        "definition": {
          "entityName": "ApiUsage",
          "schema": {
            "$ref": "#/backend/entities/ApiUsage"
          },
          "description": "Tracks API usage for a user.  Uses path-based ownership.",
          "params": [
            {
              "name": "userId",
              "description": "The unique identifier for the user."
            },
            {
              "name": "apiUsageId",
              "description": "The unique identifier for the API usage record."
            }
          ]
        }
      },
      {
        "path": "/marketData/{marketDataId}",
        "definition": {
          "entityName": "MarketData",
          "schema": {
            "$ref": "#/backend/entities/MarketData"
          },
          "description": "Stores market data. Globally readable.",
          "params": [
            {
              "name": "marketDataId",
              "description": "The unique identifier for the market data point."
            }
          ]
        }
      },
      {
        "path": "/users/{userId}/apiKeys/{apiKeyId}",
        "definition": {
          "entityName": "ApiKey",
          "schema": {
            "$ref": "#/backend/entities/ApiKey"
          },
          "description": "Stores API keys for a user. Uses path-based ownership.",
          "params": [
            {
              "name": "userId",
              "description": "The unique identifier for the user."
            },
            {
              "name": "apiKeyId",
              "description": "The unique identifier for the API key."
            }
          ]
        }
      }
    ],
    "reasoning": "The Firestore data structure is designed to ensure security, scalability, and debuggability, adhering to the principles of Authorization Independence, Clarity of Intent, DBAC (Database-Based Access Control), and QAPs (Rules are not Filters). Authorization Independence is achieved through denormalization, specifically by embedding necessary authorization data within subcollections to avoid `get()` calls in security rules. Structural Segregation is implemented by separating data with different access requirements into distinct collections. Access Modeling follows consistent patterns, using path-based ownership for private user data and membership maps for collaborative access. Here's a detailed breakdown:\n\n1.  **Users:** User profiles are stored in `/users/{userId}`.  This collection uses path-based ownership ensuring that only the authenticated user can access and modify their data. \n\n2.  **Subscription Tiers:** Subscription tier details are stored in `/subscriptionTiers/{subscriptionTierId}`. This collection stores subscription plans.\n\n3.  **API Usage:** API usage data is stored in `/users/{userId}/apiUsage/{apiUsageId}`. This structure enforces ownership where only the user can access their API usage data.\n\n4.  **Market Data:** Market data is stored in `/marketData/{marketDataId}`.  Market data is globally accessible and does not have specific ownership.\n\n5. **API Keys:** API keys are stored in `/users/{userId}/apiKeys/{apiKeyId}`. This structure enforces ownership where only the user can access their API keys.\n\nThis design supports secure `list` operations (QAPs) by segregating data based on access requirements and utilizing path-based ownership and DBAC. Each collection's security rules can be precisely defined without complex filtering logic, promoting clarity and maintainability."
  }
}